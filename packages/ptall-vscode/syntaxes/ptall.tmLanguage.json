{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Ptall",
  "scopeName": "source.ptall",
  "patterns": [{ "include": "#comment" }, { "include": "#entry" }],
  "repository": {
    "comment": {
      "name": "comment.line.double-slash.ptall",
      "match": "//.*$"
    },
    "entry": {
      "patterns": [{ "include": "#instance-entry" }, { "include": "#schema-entry" }]
    },
    "instance-entry": {
      "begin": "^([12]\\d{3}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d)\\s+(create|update)\\s+(lore|opinion|reference|journal)\\s+",
      "beginCaptures": {
        "1": { "name": "constant.numeric.timestamp.ptall" },
        "2": { "name": "keyword.control.directive.ptall" },
        "3": { "name": "entity.name.type.ptall" }
      },
      "end": "^(?=[12]\\d{3}-[01]\\d-[0-3]\\dT|$(?!\\s))",
      "patterns": [
        { "include": "#title" },
        { "include": "#link" },
        { "include": "#tag" },
        { "include": "#metadata" },
        { "include": "#content" }
      ]
    },
    "schema-entry": {
      "begin": "^([12]\\d{3}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d)\\s+(define-entity|alter-entity)\\s+([a-z][a-zA-Z0-9\\-_]*)\\s+",
      "beginCaptures": {
        "1": { "name": "constant.numeric.timestamp.ptall" },
        "2": { "name": "keyword.control.directive.ptall" },
        "3": { "name": "entity.name.type.ptall" }
      },
      "end": "^(?=[12]\\d{3}-[01]\\d-[0-3]\\dT|$(?!\\s))",
      "patterns": [
        { "include": "#title" },
        { "include": "#link" },
        { "include": "#tag" },
        { "include": "#schema-block" }
      ]
    },
    "title": {
      "name": "string.quoted.double.title.ptall",
      "match": "\"[^\"]*\""
    },
    "link": {
      "name": "entity.name.tag.link.ptall",
      "match": "\\^[A-Za-z0-9\\-_/.]+"
    },
    "tag": {
      "name": "entity.other.attribute-name.tag.ptall",
      "match": "#[A-Za-z0-9\\-_/.]+"
    },
    "metadata": {
      "match": "^(  )([a-z][a-zA-Z0-9\\-_]*)(:)\\s*(.*)$",
      "captures": {
        "2": { "name": "variable.other.property.ptall" },
        "3": { "name": "punctuation.separator.key-value.ptall" },
        "4": {
          "patterns": [
            { "include": "#link" },
            { "include": "#quoted-string" },
            { "include": "#plain-value" }
          ]
        }
      }
    },
    "quoted-string": {
      "name": "string.quoted.double.ptall",
      "match": "\"[^\"]*\""
    },
    "plain-value": {
      "name": "string.unquoted.ptall",
      "match": "[^\\r\\n]+"
    },
    "schema-block": {
      "patterns": [
        { "include": "#schema-header" },
        { "include": "#field-definition" },
        { "include": "#section-definition" }
      ]
    },
    "schema-header": {
      "match": "^(  )(#)\\s*(Metadata|Sections|Remove Metadata|Remove Sections)\\s*$",
      "captures": {
        "2": { "name": "punctuation.definition.heading.ptall" },
        "3": { "name": "markup.heading.ptall" }
      }
    },
    "field-definition": {
      "match": "^(  )([a-z][a-zA-Z0-9\\-_]*)(\\?)?(:)\\s*([^=;\\r\\n]+)(?:(=)\\s*([^;\\r\\n]+))?(?:(;)\\s*(\"[^\"]*\"))?",
      "captures": {
        "2": { "name": "variable.other.property.ptall" },
        "3": { "name": "keyword.operator.optional.ptall" },
        "4": { "name": "punctuation.separator.key-value.ptall" },
        "5": {
          "patterns": [{ "include": "#type-expression" }]
        },
        "6": { "name": "keyword.operator.assignment.ptall" },
        "7": { "name": "string.unquoted.default.ptall" },
        "8": { "name": "punctuation.separator.description.ptall" },
        "9": { "name": "comment.block.documentation.ptall" }
      }
    },
    "section-definition": {
      "match": "^(  )([A-Z][a-zA-Z0-9]*)(\\?)?(?:(;)\\s*(\"[^\"]*\"))?",
      "captures": {
        "2": { "name": "markup.heading.section.ptall" },
        "3": { "name": "keyword.operator.optional.ptall" },
        "4": { "name": "punctuation.separator.description.ptall" },
        "5": { "name": "comment.block.documentation.ptall" }
      }
    },
    "type-expression": {
      "patterns": [
        { "include": "#primitive-type" },
        { "include": "#literal-type" },
        { "include": "#array-suffix" },
        { "include": "#union-operator" }
      ]
    },
    "primitive-type": {
      "name": "support.type.primitive.ptall",
      "match": "\\b(string|date|date-range|link)\\b"
    },
    "literal-type": {
      "name": "string.quoted.double.literal-type.ptall",
      "match": "\"[^\"]*\""
    },
    "array-suffix": {
      "name": "punctuation.bracket.array.ptall",
      "match": "\\[\\]"
    },
    "union-operator": {
      "name": "keyword.operator.union.ptall",
      "match": "\\|"
    },
    "content": {
      "patterns": [{ "include": "#markdown-header" }, { "include": "#content-line" }]
    },
    "markdown-header": {
      "match": "^(  )(#+)(.*)$",
      "captures": {
        "2": { "name": "punctuation.definition.heading.markdown.ptall" },
        "3": { "name": "markup.heading.ptall" }
      }
    },
    "content-line": {
      "name": "text.plain.ptall",
      "match": "^  [^#\\r\\n][^\\r\\n]*$"
    }
  }
}
